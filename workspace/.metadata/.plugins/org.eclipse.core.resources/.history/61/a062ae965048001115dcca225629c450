package de.graind.client;

import com.google.gwt.accounts.client.AuthSubStatus;
import com.google.gwt.accounts.client.User;
import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.gdata.client.GData;
import com.google.gwt.gdata.client.GDataSystemPackage;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.Button;
import com.google.gwt.user.client.ui.RootPanel;

public class Calendar implements EntryPoint {

  private static final String API_KEY = "ABQIAAAAnkZoFwqQN8CkyJcz9_HK-xRPN_MKWMkv79GZUfaw5ZO6Y6XxJxSLFBqJP4hF05945dgmGiur4_tqpg";
  private String scope = "http://www.google.com/calendar/feeds";

  @Override
  public void onModuleLoad() {

    Button logoutButton = new Button("Logout");
    logoutButton.addClickHandler(new ClickHandler() {
      @Override
      public void onClick(ClickEvent event) {
        User.logout();
      }
    });

    if (User.getStatus() != AuthSubStatus.LOGGED_OUT) {
      RootPanel.get().add(logoutButton);
    }

    if (GData.isLoaded(GDataSystemPackage.CALENDAR)) {
      Window.alert("Calendar package is loaded");
      loadModule();
    } else {
      GData.loadGDataApi(API_KEY, new Runnable() {
        public void run() {
          loadModule();
        }
      }, GDataSystemPackage.CALENDAR);
    }
  }

  private void doAuthSubLogin() {
    AuthSubStatus status = User.getStatus(calendarUrl);

    System.out.println("Userstatus: " + status.name());
    if (status == AuthSubStatus.LOGGED_OUT) {
      User.login(calendarUrl);
    }
  }

  public void loadModule() {
    doAuthSubLogin();
  }

}
